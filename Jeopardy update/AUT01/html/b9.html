<div class="text-center pan1 ">
  <div class="mx-auto content-ncnt">
    <div class="mx-auto my-auto h-100 ">
      <div class="row mx-auto h-100">
        <div class="col-12 p-0 mx-auto my-auto h-100">
          <div id="pasos" class="h-100 position-relative">
            <img id="moneda1" src="AUT01/images/general/moneda2.png"
                 style="display:none; position:absolute; top:65%; left:50%; transform:translate(-50%,-50%); height:200px;" />

            <img id="moneda2" src="AUT01/images/general/moneda1.png"
                 style="display:none; position:absolute; top:65%; left:50%; transform:translate(-50%,-50%); height:200px;" />

            <img id="monedaG" src="AUT01/video/volado_result.gif"
                 style="display:none; position:absolute; top:65%; left:50%; transform:translate(-50%,-50%); height:200px;" />
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<audio id="audios_DL"><source type="audio/mp3"></audio>
<a id="pdf" href="" download></a>

<script>
  $(document).ready(function () {
    const audios_DL = document.getElementById('audios_DL');
    let audios_DL_index = 1;

    function startAudioDL(path, index) {
      $('#audios_DL').attr('src', 'AUT01/audio/' + path);
      audios_DL_index = index;
      audios_DL.load();
      audios_DL.play();
    }

    // Cargar SVG de fondo
    $.ajax({
      url: 'AUT01/images/svg/b9-01.svg',
      type: 'GET',
      complete: function (xhr) {
        $('#pasos').prepend(xhr.responseText);
        iniciarVolado();
      }
    });

    function iniciarVolado() {
      startAudioDL('volado.mp3', 1);

      audios_DL.addEventListener("timeupdate", function () {
        if (this.currentTime >= 5.8 && !$('#moneda1').is(':visible')) {
          $('#moneda1').fadeIn();
        }
        if (this.currentTime >= 6.4 && !$('#moneda2').is(':visible')) {
          $('#moneda2').fadeIn();
        }
        if (this.currentTime >= 14 && !$('#moneda2').hasClass('cursor')) {
          $('#moneda2').addClass('cursor');
        }
      });

      let voladoEjecutado = false;

      $('#moneda2').on('click', function () {
        if (!$(this).hasClass('cursor') || voladoEjecutado) return;

        voladoEjecutado = true; 

        startAudioDL('moneda.mp3', 2);
        const resultado = Math.random() < 0.5 ? 1 : 2;

        $('#moneda1, #moneda2').hide();
        $('#monedaG').show();

        setTimeout(() => {
          $('#monedaG').hide();
          const finalMoneda = $(`#moneda${resultado}`);
          finalMoneda.show().addClass('cursor next');

          // âœ… Segundo click: avanzar
          finalMoneda.on('click', function () {
            $('.next').click();
          });
        }, 1500);
      });
    }
  });
</script>
